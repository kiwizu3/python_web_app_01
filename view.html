<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citizens Data</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container my-4">
        <h1 class="text-center mb-4">Citizens Data</h1>

        <!-- Search Box -->
        <div class="mb-4">
            <input
                type="text"
                id="search-box"
                class="form-control citizen-search"
                placeholder="Search by Name, Email, or Location"
                onkeyup="filterCards()"
            >
        </div>

        <!-- Card Container -->
        <div class="row" id="card-container">
            <!-- Cards will be dynamically populated here -->
        </div>
    </div>

    <script>
        // Fetch citizens data and populate cards
        async function loadCitizens() {
            const response = await fetch("https://pwa001.koyeb.app/api/citizens");
            const citizens = await response.json();
            const container = document.getElementById("card-container");

            citizens.forEach((citizen) => {
                const card = document.createElement("div");
                card.classList.add("col-md-4", "mb-3", "citizen-card");
                card.dataset.name = citizen.name.toLowerCase();
                card.dataset.email = citizen.email.toLowerCase();
                card.dataset.location = citizen.location.toLowerCase();

                card.innerHTML = `
                    <div class="card citizen-card-1 shadow">
                        <div class="card-body">
                            <h5 class="card-title">${citizen.name}</h5>
                            <p class="card-text">
                                <strong>Email:</strong> ${citizen.email} <br>
                                <strong>Phone:</strong> ${citizen.phone} <br>
                                <strong>Location:</strong> ${citizen.location}
                            </p>
                            <button class="btn citizen-button btn-danger btn-md" onclick="deleteCitizen(${citizen.id})">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Filter cards based on search input
        function filterCards() {
            const searchQuery = document.getElementById("search-box").value.toLowerCase();
            const cards = document.querySelectorAll(".citizen-card");

            cards.forEach((card) => {
                const name = card.dataset.name;
                const email = card.dataset.email;
                const location = card.dataset.location;

                if (name.includes(searchQuery) || email.includes(searchQuery) || location.includes(searchQuery)) {
                    card.style.display = "block";
                } else {
                    card.style.display = "none";
                }
            });
        }

        // Delete citizen by ID
        async function deleteCitizen(id) {
            if (confirm("Are you sure you want to delete this citizen?")) {
                const response = await fetch(`https://pwa001.koyeb.app/api/citizens/${id}`, {
                    method: "DELETE",
                });

                if (response.ok) {
                    alert("Citizen deleted successfully!");
                    document.getElementById("card-container").innerHTML = "";
                    loadCitizens(); // Reload the cards
                } else {
                    alert("Failed to delete citizen.");
                }
            }
        }

        // Load citizens data on page load
        window.onload = loadCitizens;
    </script>
</body>
</html>
